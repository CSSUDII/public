"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports["default"] = void 0;

var _jsonwebtoken = _interopRequireDefault(require("jsonwebtoken"));

var _db = _interopRequireDefault(require("../../config/db.config"));

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { "default": obj }; }

var checkToken = function checkToken(req, res, next) {
  var token = req.header("auth-token");
  if (!token) return res.status(401).json({
    auth: false,
    error: "No token was provided."
  });

  try {
    var configToken = _db["default"].token; // Hack to allow undefined string

    var verified = _jsonwebtoken["default"].verify(token, configToken);

    req.user = verified;
    next();
  } catch (err) {
    res.status(400).json({
      auth: false,
      error: "Failed to authenticate token."
    });
  }

  next();
};

var _default = checkToken;
exports["default"] = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9zZXJ2ZXIvUm91dGVyRnVuY3Rpb25zL2NoZWNrVG9rZW4udHMiXSwibmFtZXMiOlsiY2hlY2tUb2tlbiIsInJlcSIsInJlcyIsIm5leHQiLCJ0b2tlbiIsImhlYWRlciIsInN0YXR1cyIsImpzb24iLCJhdXRoIiwiZXJyb3IiLCJjb25maWdUb2tlbiIsImNvbmZpZyIsInZlcmlmaWVkIiwiand0IiwidmVyaWZ5IiwidXNlciIsImVyciJdLCJtYXBwaW5ncyI6Ijs7Ozs7OztBQUFBOztBQUVBOzs7O0FBRUEsSUFBTUEsVUFBZSxHQUFHLFNBQWxCQSxVQUFrQixDQUFDQyxHQUFELEVBQWlFQyxHQUFqRSxFQUF1TUMsSUFBdk0sRUFBNE47QUFDaFAsTUFBTUMsS0FBSyxHQUFHSCxHQUFHLENBQUNJLE1BQUosQ0FBVyxZQUFYLENBQWQ7QUFDQSxNQUFJLENBQUNELEtBQUwsRUFBWSxPQUFPRixHQUFHLENBQUNJLE1BQUosQ0FBVyxHQUFYLEVBQWdCQyxJQUFoQixDQUFxQjtBQUFFQyxJQUFBQSxJQUFJLEVBQUUsS0FBUjtBQUFlQyxJQUFBQSxLQUFLLEVBQUU7QUFBdEIsR0FBckIsQ0FBUDs7QUFFWixNQUFJO0FBQ0EsUUFBTUMsV0FBZ0IsR0FBR0MsZUFBT1AsS0FBaEMsQ0FEQSxDQUNzQzs7QUFDdEMsUUFBTVEsUUFBUSxHQUFHQyx5QkFBSUMsTUFBSixDQUFXVixLQUFYLEVBQWtCTSxXQUFsQixDQUFqQjs7QUFDQVQsSUFBQUEsR0FBRyxDQUFDYyxJQUFKLEdBQVdILFFBQVg7QUFDQVQsSUFBQUEsSUFBSTtBQUNQLEdBTEQsQ0FLRSxPQUFPYSxHQUFQLEVBQVk7QUFDVmQsSUFBQUEsR0FBRyxDQUFDSSxNQUFKLENBQVcsR0FBWCxFQUFnQkMsSUFBaEIsQ0FBcUI7QUFBRUMsTUFBQUEsSUFBSSxFQUFFLEtBQVI7QUFBZUMsTUFBQUEsS0FBSyxFQUFFO0FBQXRCLEtBQXJCO0FBQ0g7O0FBRUROLEVBQUFBLElBQUk7QUFFUCxDQWZEOztlQWlCZUgsVSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBqd3QgZnJvbSBcImpzb253ZWJ0b2tlblwiO1xuXG5pbXBvcnQgY29uZmlnIGZyb20gXCIuLi8uLi9jb25maWcvZGIuY29uZmlnXCI7XG5cbmNvbnN0IGNoZWNrVG9rZW46IGFueSA9IChyZXE6IHsgaGVhZGVyOiAoYXJnMDogc3RyaW5nKSA9PiBhbnk7IHVzZXI6IHN0cmluZyB8IG9iamVjdDsgfSwgcmVzOiB7IHN0YXR1czogKGFyZzA6IG51bWJlcikgPT4geyAoKTogYW55OyBuZXcoKTogYW55OyBqc29uOiB7IChhcmcwOiB7IGF1dGg6IGJvb2xlYW47IGVycm9yOiBzdHJpbmc7IH0pOiB2b2lkOyBuZXcoKTogYW55OyB9OyB9OyB9LCBuZXh0OiAoKSA9PiB2b2lkKSA9PiB7XG4gICAgY29uc3QgdG9rZW4gPSByZXEuaGVhZGVyKFwiYXV0aC10b2tlblwiKTtcbiAgICBpZiAoIXRva2VuKSByZXR1cm4gcmVzLnN0YXR1cyg0MDEpLmpzb24oeyBhdXRoOiBmYWxzZSwgZXJyb3I6IFwiTm8gdG9rZW4gd2FzIHByb3ZpZGVkLlwiIH0pO1xuXG4gICAgdHJ5IHtcbiAgICAgICAgY29uc3QgY29uZmlnVG9rZW46IGFueSA9IGNvbmZpZy50b2tlbiAvLyBIYWNrIHRvIGFsbG93IHVuZGVmaW5lZCBzdHJpbmdcbiAgICAgICAgY29uc3QgdmVyaWZpZWQgPSBqd3QudmVyaWZ5KHRva2VuLCBjb25maWdUb2tlbik7XG4gICAgICAgIHJlcS51c2VyID0gdmVyaWZpZWQ7XG4gICAgICAgIG5leHQoKTtcbiAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgICAgcmVzLnN0YXR1cyg0MDApLmpzb24oeyBhdXRoOiBmYWxzZSwgZXJyb3I6IFwiRmFpbGVkIHRvIGF1dGhlbnRpY2F0ZSB0b2tlbi5cIiB9KTtcbiAgICB9XG5cbiAgICBuZXh0KCk7XG5cbn07XG5cbmV4cG9ydCBkZWZhdWx0IGNoZWNrVG9rZW47Il19